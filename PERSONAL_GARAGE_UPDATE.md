# –£—Ç–æ—á–Ω–µ–Ω–∏–µ: PersonalGarage –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞

### –õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å PersonalGarage

```dart
// INVESTOR - –í–ª–∞–¥–µ–ª–µ—Ü-–∏–Ω–≤–µ—Å—Ç–æ—Ä
PersonalGarage(
  ownerId: investorUserId,
  name: '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –∞–≤—Ç–æ–ø–∞—Ä–∫',
  managingCompanyId: 'ORG_123',  // –ü–µ—Ä–µ–¥–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
  commissionRate: 0.15,           // 15% –∫–æ–º–ø–∞–Ω–∏–∏ –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
)

// DIRECTOR - –£–ø—Ä–∞–≤–ª—è—é—â–∏–π
PersonalGarage(
  ownerId: directorUserId,
  name: '–õ–∏—á–Ω—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏',
  managingCompanyId: null,        // –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∞–º
  commissionRate: 0.0,
)

// MANAGER - –ú–µ–Ω–µ–¥–∂–µ—Ä
PersonalGarage(
  ownerId: managerUserId,
  name: '–ú–æ–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏',
  managingCompanyId: 'ORG_456',  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ –∫–æ–º–ø–∞–Ω–∏—é
  commissionRate: 0.10,           // 10% –∫–æ–º–ø–∞–Ω–∏–∏
)

// GUEST - –ì–æ—Å—Ç—å (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä)
PersonalGarage(
  ownerId: guestUserId,
  name: '–ü—Ä–æ—Å–º–æ—Ç—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π',
  managingCompanyId: 'ORG_789',  // –ö–æ–º–ø–∞–Ω–∏—è —É–ø—Ä–∞–≤–ª—è–µ—Ç
  commissionRate: 0.20,           // 20% –∫–æ–º–ø–∞–Ω–∏–∏
)
```

## üìä –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: INVESTOR —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∞–≤—Ç–æ
```
INVESTOR (–ò–≤–∞–Ω –ò–Ω–≤–µ—Å—Ç–æ—Ä)
‚îî‚îÄ PersonalGarage "–ú–æ–π –∞–≤—Ç–æ–ø–∞—Ä–∫"
   ‚îú‚îÄ 5 –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
   ‚îú‚îÄ –£–ø—Ä–∞–≤–ª—è—é—â–∞—è –∫–æ–º–ø–∞–Ω–∏—è: "ProRent LLC"
   ‚îú‚îÄ –ö–æ–º–∏—Å—Å–∏—è: 15%
   ‚îî‚îÄ –î–æ—Ö–æ–¥: 85% –æ—Ç –∞—Ä–µ–Ω–¥—ã
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: DIRECTOR —Å –ª–∏—á–Ω—ã–º–∏ –∏ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º–∏ –∞–≤—Ç–æ
```
DIRECTOR (–ü–µ—Ç—Ä –£–ø—Ä–∞–≤–ª—è—é—â–∏–π)
‚îú‚îÄ PersonalGarage "–ú–æ–∏ –∞–≤—Ç–æ"
‚îÇ  ‚îú‚îÄ 2 –ª–∏—á–Ω—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª—è
‚îÇ  ‚îú‚îÄ –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∞–º
‚îÇ  ‚îî‚îÄ –î–æ—Ö–æ–¥: 100%
‚îÇ
‚îî‚îÄ CompanyGarage "–ê–≤—Ç–æ–ø–∞—Ä–∫ –∫–æ–º–ø–∞–Ω–∏–∏"
   ‚îú‚îÄ 20 –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∞–≤—Ç–æ
   ‚îú‚îÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–ø–∞—Ä–∫–æ–º
   ‚îî‚îÄ –ó–∞—Ä–ø–ª–∞—Ç–∞ –æ—Ç –∫–æ–º–ø–∞–Ω–∏–∏
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: MANAGER —Å –ª–∏—á–Ω—ã–º–∏ –∞–≤—Ç–æ
```
MANAGER (–°–µ—Ä–≥–µ–π –ú–µ–Ω–µ–¥–∂–µ—Ä)
‚îú‚îÄ PersonalGarage "–ú–æ–π –≥–∞—Ä–∞–∂"
‚îÇ  ‚îú‚îÄ 1 –∞–≤—Ç–æ–º–æ–±–∏–ª—å
‚îÇ  ‚îú‚îÄ –£–ø—Ä–∞–≤–ª—è—é—â–∞—è –∫–æ–º–ø–∞–Ω–∏—è: "RentPro"
‚îÇ  ‚îú‚îÄ –ö–æ–º–∏—Å—Å–∏—è: 10%
‚îÇ  ‚îî‚îÄ –î–æ—Ö–æ–¥: 90%
‚îÇ
‚îî‚îÄ –†–∞–±–æ—Ç–∞ —Å —á—É–∂–∏–º–∏ –∞–≤—Ç–æ (—á–µ—Ä–µ–∑ CarPermissions)
   ‚îú‚îÄ 15 –∞–≤—Ç–æ –∫–æ–º–ø–∞–Ω–∏–∏ (–ø–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º)
   ‚îî‚îÄ –ö–æ–º–∏—Å—Å–∏—è —Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### Security Rules
```javascript
// –°–æ–∑–¥–∞—Ç—å –ª–∏—á–Ω—ã–π –≥–∞—Ä–∞–∂ –º–æ–∂–µ—Ç –ª—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
allow create: if isSignedIn() && 
                 request.resource.data.type == 'PERSONAL' && 
                 request.resource.data.owner_id == request.auth.uid;

// –£–ø—Ä–∞–≤–ª—è—Ç—å –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü
allow update, delete: if isSignedIn() && 
                         resource.data.owner_id == request.auth.uid;
```

### AccessControl
```dart
// –õ—é–±–æ–π –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ª–∏—á–Ω—ã–π –≥–∞—Ä–∞–∂
Future<bool> canCreatePersonalGarage(String userId) async {
  return true; // –õ—é–±–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
}

// –£–ø—Ä–∞–≤–ª—è—Ç—å –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü
Future<bool> canManageGarage(String userId, PersonalGarage garage) async {
  return garage.ownerId == userId;
}
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è –ø–æ —Ä–æ–ª—è–º

| –†–æ–ª—å | Personal Garage | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –ö–æ–º–∏—Å—Å–∏—è |
|------|----------------|------------|----------|
| INVESTOR | ‚úÖ –î–∞ | –ß–µ—Ä–µ–∑ –∫–æ–º–ø–∞–Ω–∏—é | 10-20% |
| DIRECTOR | ‚úÖ –î–∞ | –°–∞–º –∏–ª–∏ –∫–æ–º–ø–∞–Ω–∏—è | 0-15% |
| MANAGER | ‚úÖ –î–∞ | –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∫–æ–º–ø–∞–Ω–∏—é | 5-10% |
| GUEST | ‚úÖ –î–∞ | –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä | 15-25% |

## üìù –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—á–Ω–æ–≥–æ –≥–∞—Ä–∞–∂–∞ –¥–ª—è –ª—é–±–æ–π —Ä–æ–ª–∏
```dart
Future<String> createUserPersonalGarage({
  required String userId,
  required String userName,
  required GlobalRole userRole,
  String? managingCompanyId,
}) async {
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–∏
  final commissionRate = switch (userRole) {
    GlobalRole.investor => 0.15,   // INVESTOR –æ–±—ã—á–Ω–æ 15%
    GlobalRole.director => 0.0,    // DIRECTOR —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∞–º
    GlobalRole.manager => 0.10,    // MANAGER —á–µ—Ä–µ–∑ –∫–æ–º–ø–∞–Ω–∏—é 10%
    GlobalRole.guest => 0.20,      // GUEST —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä, 20%
  };
  };
  
  final garage = PersonalGarage(
    id: 'personal_garage_${DateTime.now().millisecondsSinceEpoch}',
    name: '$userName - –õ–∏—á–Ω—ã–π –≥–∞—Ä–∞–∂',
    ownerId: userId,
    managingCompanyId: managingCompanyId,
    commissionRate: commissionRate,
    createdAt: DateTime.now(),
    updatedAt: DateTime.now(),
  );

  await FirebaseFirestore.instance
      .collection('garages')
      .doc(garage.id)
      .set(garage.toFirestore());
      
  return garage.id;
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–≤—Ç–æ
```dart
Future<bool> canAddCarToPersonalGarage(
  String userId, 
  PersonalGarage garage,
  GlobalRole userRole,
) async {
  // –í–ª–∞–¥–µ–ª–µ—Ü –≥–∞—Ä–∞–∂–∞ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∞–≤—Ç–æ
  if (garage.ownerId != userId) return false;
  
  // –í—Å–µ —Ä–æ–ª–∏ –º–æ–≥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∞–≤—Ç–æ –≤ —Å–≤–æ–π –ª–∏—á–Ω—ã–π –≥–∞—Ä–∞–∂
  return true;
}
```

## ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ

1. ‚úÖ `lib/models/garage.dart` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
2. ‚úÖ `lib/utils/access_control.dart` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫
3. ‚úÖ `DATABASE_USAGE_GUIDE.md` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –≤—Å–µ—Ö —Ä–æ–ª–µ–π
4. ‚úÖ `IMPLEMENTATION_REPORT.md` - —É—Ç–æ—á–Ω–µ–Ω—ã –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
5. ‚úÖ `FIRESTORE_SCHEMA.md` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
6. ‚úÖ `firestore.rules` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥–∞—Ä–∞–∂–µ–π

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–¢–µ–ø–µ—Ä—å –ª—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
- –°–æ–∑–¥–∞—Ç—å —Å–≤–æ–π –ª–∏—á–Ω—ã–π –≥–∞—Ä–∞–∂
- –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏
- –í—ã–±—Ä–∞—Ç—å —É–ø—Ä–∞–≤–ª—è—é—â—É—é –∫–æ–º–ø–∞–Ω–∏—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ü–æ–ª—É—á–∞—Ç—å –¥–æ—Ö–æ–¥ –æ—Ç —Å–≤–æ–∏—Ö –∞–≤—Ç–æ
- –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —á—É–∂–∏–º–∏ –∞–≤—Ç–æ (–¥–ª—è MANAGER –∏ DIRECTOR)
