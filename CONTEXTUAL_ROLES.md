# –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö —Ä–æ–ª–µ–π

## üìã –û–±–∑–æ—Ä

–†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–µ–ø–µ—Ä—å **–∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ** - –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ç–æ–≥–æ, –≤ –∫–∞–∫–æ–º –≥–∞—Ä–∞–∂–µ –∏–ª–∏ –∫–æ–º–ø–∞–Ω–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ —Ä–æ–ª–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö.

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. –ù–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Ä–æ–ª–∏
- –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ `globalRole` –∏–∑ –º–æ–¥–µ–ª–∏ `AppUser`
- –†–æ–ª—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (–∫–æ–º–ø–∞–Ω–∏—è/–≥–∞—Ä–∞–∂)
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ - GUEST (–µ—Å–ª–∏ –Ω–µ—Ç —Ä–æ–ª–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ)

### 2. –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è —Ä–æ–ª—å
```dart
UserRole(
  userId: "user123",
  companyId: "company_abc",  // –ò–õ–ò garageId
  roleType: RoleType.director,
  isActive: true,
)
```

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
- –°–æ–∑–¥–∞—Ç–µ–ª—å –≥–∞—Ä–∞–∂–∞ ‚Üí OWNER –≥–∞—Ä–∞–∂–∞
- –°–æ–∑–¥–∞—Ç–µ–ª—å –∫–æ–º–ø–∞–Ω–∏–∏ ‚Üí OWNER –∫–æ–º–ø–∞–Ω–∏–∏

## üîë –¢–∏–ø—ã —Ä–æ–ª–µ–π

```dart
enum RoleType {
  owner,      // –í–ª–∞–¥–µ–ª–µ—Ü –≥–∞—Ä–∞–∂–∞/–∫–æ–º–ø–∞–Ω–∏–∏
  director,   // –î–∏—Ä–µ–∫—Ç–æ—Ä –∫–æ–º–ø–∞–Ω–∏–∏
  manager,    // –ú–µ–Ω–µ–¥–∂–µ—Ä —Å –ø—Ä–∞–≤–æ–º –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  agent,      // –ê–≥–µ–Ω—Ç - —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∑–∞—è–≤–∫–∏ –Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
  guest       // –ì–æ—Å—Ç—å (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä)
}
```

### –ò–µ—Ä–∞—Ä—Ö–∏—è
```
OWNER > DIRECTOR > MANAGER > AGENT > GUEST
```

### –û–ø–∏—Å–∞–Ω–∏–µ —Ä–æ–ª–µ–π

#### OWNER (–í–ª–∞–¥–µ–ª–µ—Ü)
- **–í –≥–∞—Ä–∞–∂–µ**: –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–≤–æ–∏–º–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏
- **–í –∫–æ–º–ø–∞–Ω–∏–∏**: –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å + –º–æ–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç—å –∫–æ–º–ø–∞–Ω–∏—é
- –ù–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏

#### DIRECTOR (–î–∏—Ä–µ–∫—Ç–æ—Ä)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–µ–π (–∫—Ä–æ–º–µ –∑–∞–∫—Ä—ã—Ç–∏—è)
- –í—ã–¥–∞—á–∞ –ø—Ä–∞–≤ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º –∏ –∞–≥–µ–Ω—Ç–∞–º
- –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤–æ–∏—Ö –ø—Ä–∞–≤
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫ –∞–≥–µ–Ω—Ç–æ–≤
- –ú–æ–∂–µ—Ç –≤—ã–¥–∞—Ç—å –ø—Ä–∞–≤–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞—è–≤–æ–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º
- –ù–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –∫–æ–º–ø–∞–Ω–∏–∏

#### MANAGER (–ú–µ–Ω–µ–¥–∂–µ—Ä)
- **–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –†–∞–±–æ—Ç–∞ —Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏ (–ø–æ –ø—Ä–∞–≤–∞–º –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∞–≤—Ç–æ)
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ú–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –æ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ –ø—Ä–∞–≤–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å –∑–∞—è–≤–∫–∏ –∞–≥–µ–Ω—Ç–æ–≤
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–º –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º

#### AGENT (–ê–≥–µ–Ω—Ç)
- **–§–æ—Ä–º–∏—Ä—É–µ—Ç –∑–∞—è–≤–∫–∏** –Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
- –†–∞–±–æ—Ç–∞ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, –ø—Ä–æ—Å–º–æ—Ç—Ä)
- **–§–æ—Ä–º–∏—Ä—É–µ—Ç –∑–∞—è–≤–∫–∏** –Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
- –†–∞–±–æ—Ç–∞ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, –ø—Ä–æ—Å–º–æ—Ç—Ä)
- –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞—è–≤–æ–∫ –Ω–∞ —Ä–∞–∑–Ω—ã–µ –º–∞—à–∏–Ω—ã
- –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º, –≤—ã–±–∏—Ä–∞–µ—Ç –æ–¥–Ω—É ‚Üí –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–Ω—É–ª–∏—Ä—É—é—Ç—Å—è
- –ù–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é
- –ó–∞—è–≤–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç: –¥–∏—Ä–µ–∫—Ç–æ—Ä –∏–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä —Å –ø—Ä–∞–≤–æ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –ù–∞—á–∞–ª—å–Ω–∞—è —Ä–æ–ª—å –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

#### GUEST (–ì–æ—Å—Ç—å)
- –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
- –†–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üìã Workflow –∑–∞—è–≤–æ–∫ –∞–≥–µ–Ω—Ç–∞

```
1. –ê–ì–ï–ù–¢ —Å–æ–∑–¥–∞–µ—Ç 3 –∑–∞—è–≤–∫–∏ (Car A, B, C) ‚Üí status: PENDING

2. –ú–ï–ù–ï–î–ñ–ï–†–´ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç:
   - Car A ‚Üí APPROVED ‚úì
   - Car B ‚Üí –æ—Å—Ç–∞–µ—Ç—Å—è PENDING
   - Car C ‚Üí APPROVED ‚úì

3. –ê–ì–ï–ù–¢ –≤—ã–±–∏—Ä–∞–µ—Ç Car A:
   - Car A ‚Üí CONFIRMED ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è Rental
   - Car B ‚Üí –æ—Å—Ç–∞–µ—Ç—Å—è PENDING
   - Car C ‚Üí AUTO_ANNULLED (–º–∞—à–∏–Ω–∞ —Å–Ω–æ–≤–∞ –¥–æ—Å—Ç—É–ø–Ω–∞)
```

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### Firestore –∫–æ–ª–ª–µ–∫—Ü–∏—è: `user_roles`

```
user_roles/{roleId}
  - user_id: string          // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - company_id?: string      // ID –∫–æ–º–ø–∞–Ω–∏–∏ (–µ—Å–ª–∏ —Ä–æ–ª—å –≤ –∫–æ–º–ø–∞–Ω–∏–∏)
  - garage_id?: string       // ID –≥–∞—Ä–∞–∂–∞ (–µ—Å–ª–∏ —Ä–æ–ª—å –≤ –≥–∞—Ä–∞–∂–µ)
  - role_type: string        // OWNER/DIRECTOR/MANAGER/AGENT/GUEST
  - granted_by?: string      // –ö—Ç–æ –≤—ã–¥–∞–ª —Ä–æ–ª—å
  - granted_at: timestamp
  - is_active: boolean
```

**–í–∞–∂–Ω–æ**: –õ–∏–±–æ `company_id`, –ª–∏–±–æ `garage_id` - –Ω–µ –æ–±–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø–∏—Å–µ–π

#### –í–ª–∞–¥–µ–ª–µ—Ü –≥–∞—Ä–∞–∂–∞
```json
{
  "user_id": "user123",
  "garage_id": "garage_abc",
  "role_type": "OWNER",
  "granted_at": "2025-01-15T10:00:00Z",
  "is_active": true
}
```

#### –î–∏—Ä–µ–∫—Ç–æ—Ä –∫–æ–º–ø–∞–Ω–∏–∏
```json
{
  "user_id": "user456",
  "company_id": "company_xyz",
  "role_type": "DIRECTOR",
  "granted_by": "user_owner",
  "granted_at": "2025-01-16T14:30:00Z",
  "is_active": true
}
```

#### –í–Ω–µ—à–Ω–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä-–ø–∞—Ä—Ç–Ω–µ—Ä
```json
{
  "user_id": "user789",
  "company_id": "company_other",
  "role_type": "MANAGER",
  "granted_by": "director_id",
  "granted_at": "2025-01-20T09:00:00Z",
  "is_active": true
}
```

## üíº –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏

–û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å **—Ä–∞–∑–Ω—ã–µ —Ä–æ–ª–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö**:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ò–≤–∞–Ω (user123):
‚îú‚îÄ‚îÄ –ì–∞—Ä–∞–∂ "My Cars" ‚Üí OWNER
‚îú‚îÄ‚îÄ –ö–æ–º–ø–∞–Ω–∏—è "ABC Rent" ‚Üí OWNER (—Å–æ–∑–¥–∞—Ç–µ–ª—å)
‚îú‚îÄ‚îÄ –ö–æ–º–ø–∞–Ω–∏—è "XYZ Auto" ‚Üí MANAGER (–≤–Ω–µ—à–Ω–∏–π –ø–∞—Ä—Ç–Ω–µ—Ä)
‚îî‚îÄ‚îÄ –ì–∞—Ä–∞–∂ "Partner Garage" ‚Üí GUEST (–ø—Ä–æ—Å–º–æ—Ç—Ä)
```

## üñ•Ô∏è –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–µ–Ω–µ–¥–∂–µ—Ä–∞
–û—Å–Ω–æ–≤–∞ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —Å –Ω–∏–∂–Ω–µ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π.

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –≤–∫–ª–∞–¥–∫–∏

–í–∫–ª–∞–¥–∫–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–µ–π:

#### 1. "–ú–æ–π –≥–∞—Ä–∞–∂"
- **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è**: –µ—Å–ª–∏ –µ—Å—Ç—å —Ä–æ–ª—å OWNER –≤ –∫–∞–∫–æ–º-–ª–∏–±–æ –≥–∞—Ä–∞–∂–µ
- **–§—É–Ω–∫—Ü–∏–∏**: 
  - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
  - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ
  - –í—ã–¥–∞—á–∞ –ø—Ä–∞–≤ canView

#### 2. "–ú–æ—è –∫–æ–º–ø–∞–Ω–∏—è"
- **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è**: –µ—Å–ª–∏ –µ—Å—Ç—å —Ä–æ–ª—å OWNER –∏–ª–∏ DIRECTOR –≤ –∫–∞–∫–æ–π-–ª–∏–±–æ –∫–æ–º–ø–∞–Ω–∏–∏
- **–§—É–Ω–∫—Ü–∏–∏**:
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–µ–π
  - –í—ã–¥–∞—á–∞ –ø—Ä–∞–≤ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º
  - –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å
  - –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤ (—Ç–æ–ª—å–∫–æ OWNER/DIRECTOR)

#### 3. "–ú–æ–∏ –ø–∞—Ä—Ç–Ω–µ—Ä—ã"
- **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è**: –µ—Å–ª–∏ –µ—Å—Ç—å —Ä–æ–ª—å MANAGER (–Ω–æ –Ω–µ OWNER/DIRECTOR)
- **–§—É–Ω–∫—Ü–∏–∏**:
  - –°–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π-–ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
  - –†–∞–±–æ—Ç–∞ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–∏—Å—Å–∏–π

### –û—Ç–¥–µ–ª—å–Ω—ã–π –≤—Ö–æ–¥ –¥–ª—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤
–î–ª—è –ø–∞—Å—Å–∏–≤–Ω—ã—Ö –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π - —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
- –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤
- –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –ë–ï–ó –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –ü–æ–ª—É—á–∏—Ç—å —Ä–æ–ª—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

```dart
final roleService = UserRoleService();

// –í –∫–æ–º–ø–∞–Ω–∏–∏
final roleInCompany = await roleService.getUserRoleInCompany(
  userId, 
  companyId,
);

// –í –≥–∞—Ä–∞–∂–µ
final roleInGarage = await roleService.getUserRoleInGarage(
  userId, 
  garageId,
);

// –í—Å–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
final allRoles = await roleService.getUserRoles(userId);
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤

```dart
// –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –∫–æ–º–ø–∞–Ω–∏–∏
final isOwner = await roleService.isCompanyOwner(userId, companyId);

// –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–º (OWNER –∏–ª–∏ DIRECTOR)
final isDirector = await roleService.isCompanyDirector(userId, companyId);

// –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º (–ª—é–±–∞—è —Ä–æ–ª—å –≤—ã—à–µ GUEST)
final isManager = await roleService.isCompanyManager(userId, companyId);
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–µ–π

#### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≥–∞—Ä–∞–∂–∞
```dart
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ä–æ–ª—å OWNER
await roleService.createGarageOwnerRole(
  userId: currentUserId,
  garageId: newGarageId,
);
```

#### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–ø–∞–Ω–∏–∏
```dart
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ä–æ–ª—å OWNER
await roleService.createCompanyOwnerRole(
  userId: currentUserId,
  companyId: newCompanyId,
);
```

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
```dart
// –î–∏—Ä–µ–∫—Ç–æ—Ä –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞
await roleService.assignCompanyRole(
  userId: managerId,
  companyId: companyId,
  roleType: RoleType.manager,
  grantedBy: directorId,
);
```

### –û—Ç–∑—ã–≤ —Ä–æ–ª–µ–π

```dart
// –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ä–æ–ª—å –≤ –∫–æ–º–ø–∞–Ω–∏–∏
await roleService.revokeCompanyRole(
  userId: managerId,
  companyId: companyId,
);
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Ä–æ–ª–µ–π

### –°—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞
```dart
AppUser(
  uid: "user123",
  globalRole: GlobalRole.director,  // ‚ùå –£–¥–∞–ª–µ–Ω–æ
)
```

### –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
```dart
AppUser(
  uid: "user123",
  // globalRole —É–¥–∞–ª–µ–Ω–æ
)

// –†–æ–ª–∏ —Ç–µ–ø–µ—Ä—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏
UserRole(
  userId: "user123",
  companyId: "company_abc",
  roleType: RoleType.director,
)
```

### –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

```dart
Future<void> migrateGlobalRolesToContextual() async {
  final users = await FirebaseFirestore.instance
      .collection('users')
      .get();

  for (final userDoc in users.docs) {
    final data = userDoc.data();
    final globalRole = data['global_role'];
    final organizations = List<String>.from(data['organizations'] ?? []);

    if (globalRole == 'DIRECTOR' && organizations.isNotEmpty) {
      // –°–æ–∑–¥–∞—Ç—å —Ä–æ–ª—å DIRECTOR –¥–ª—è –∫–∞–∂–¥–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
      for (final orgId in organizations) {
        await UserRoleService().assignCompanyRole(
          userId: userDoc.id,
          companyId: orgId,
          roleType: RoleType.director,
          grantedBy: 'system_migration',
        );
      }
    }

    // –£–¥–∞–ª–∏—Ç—å global_role –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞
    await userDoc.reference.update({'global_role': FieldValue.delete()});
  }
}
```

## üì± –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –í–ª–∞–¥–µ–ª–µ—Ü –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
```
–ò–≤–∞–Ω —Å–æ–∑–¥–∞–µ—Ç –ª–∏—á–Ω—ã–π –≥–∞—Ä–∞–∂ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ OWNER –≥–∞—Ä–∞–∂–∞
‚Üí –í–∏–¥–∏—Ç –≤–∫–ª–∞–¥–∫—É "–ú–æ–π –≥–∞—Ä–∞–∂"
‚Üí –ú–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∞–≤—Ç–æ –∏ –≤—ã–¥–∞–≤–∞—Ç—å canView
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
```
–ò–≤–∞–Ω —Å–æ–∑–¥–∞–µ—Ç –∫–æ–º–ø–∞–Ω–∏—é "ABC Rent" ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ OWNER –∫–æ–º–ø–∞–Ω–∏–∏
‚Üí –í–∏–¥–∏—Ç –≤–∫–ª–∞–¥–∫—É "–ú–æ—è –∫–æ–º–ø–∞–Ω–∏—è"
‚Üí –ú–æ–∂–µ—Ç –Ω–∞–∑–Ω–∞—á–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –í–Ω–µ—à–Ω–∏–π –ø–∞—Ä—Ç–Ω–µ—Ä
```
–ü–µ—Ç—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –≤ "ABC Rent"
‚Üí –î–∏—Ä–µ–∫—Ç–æ—Ä –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –µ–º—É —Ä–æ–ª—å MANAGER
‚Üí –£ –ü–µ—Ç—Ä–∞ –µ—Å—Ç—å –≤–∫–ª–∞–¥–∫–∞ "–ú–æ–∏ –ø–∞—Ä—Ç–Ω–µ—Ä—ã"
‚Üí –í–∏–¥–∏—Ç "ABC Rent" –≤ —Å–ø–∏—Å–∫–µ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
‚Üí –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –ø–æ–ª—É—á–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏
```
–ú–∞—Ä–∏—è:
- –í–ª–∞–¥–µ–µ—Ç –≥–∞—Ä–∞–∂–æ–º "My Cars" (OWNER)
- –°–æ–∑–¥–∞–ª–∞ –∫–æ–º–ø–∞–Ω–∏—é "XYZ Auto" (OWNER)
- –†–∞–±–æ—Ç–∞–µ—Ç –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º –≤ "Partner Fleet" (MANAGER)

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ú–∞—Ä–∏–∏:
‚îú‚îÄ‚îÄ "–ú–æ–π –≥–∞—Ä–∞–∂" (–≤–ª–∞–¥–µ–µ—Ç "My Cars")
‚îú‚îÄ‚îÄ "–ú–æ—è –∫–æ–º–ø–∞–Ω–∏—è" (–¥–∏—Ä–µ–∫—Ç–æ—Ä "XYZ Auto")
‚îî‚îÄ‚îÄ "–ú–æ–∏ –ø–∞—Ä—Ç–Ω–µ—Ä—ã" (–ø–∞—Ä—Ç–Ω–µ—Ä –≤ "Partner Fleet")
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–û–¥–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –ú–æ–∂–Ω–æ –±—ã—Ç—å OWNER —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
2. **–†–æ–ª—å OWNER –Ω–µ–æ—Ç–∑—ã–≤–∞–µ–º–∞**: –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å/–∑–∞–∫—Ä—ã—Ç—å –∫–æ–º–ø–∞–Ω–∏—é
3. **–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ**: –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–º–ø–∞–Ω–∏–∏/–≥–∞—Ä–∞–∂–∞ - —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–æ–ª–∏
4. **–ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è**: –†–æ–ª–∏ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è, –∞ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è (`is_active: false`)

## üé® UI/UX —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
```dart
// –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
AppBar(
  title: Text('ABC Rent'), // –¢–µ–∫—É—â–∞—è –∫–æ–º–ø–∞–Ω–∏—è
  actions: [
    // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    ContextSwitcher(
      currentContext: 'company_abc',
      availableContexts: userRoles,
    ),
  ],
)
```

### –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ä–æ–ª–µ–π
```dart
// –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–æ–ª—å –≤ —Å–ø–∏—Å–∫–µ –∫–æ–º–ø–∞–Ω–∏–π/–≥–∞—Ä–∞–∂–µ–π
ListTile(
  title: Text('ABC Rent'),
  subtitle: Text('–î–∏—Ä–µ–∫—Ç–æ—Ä'),  // RoleType.director.description
  leading: Icon(
    roleType == RoleType.owner ? Icons.crown :
    roleType == RoleType.director ? Icons.manage_accounts :
    roleType == RoleType.manager ? Icons.person :
    Icons.visibility,
  ),
)
```

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

1. **–ì–∏–±–∫–æ—Å—Ç—å**: –û–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫ - –º–Ω–æ–≥–æ —Ä–æ–ª–µ–π –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö
2. **–†–µ–∞–ª—å–Ω–æ—Å—Ç—å**: –û—Ç—Ä–∞–∂–∞–µ—Ç –Ω–∞—Å—Ç–æ—è—â–∏–µ –±–∏–∑–Ω–µ—Å-–æ—Ç–Ω–æ—à–µ–Ω–∏—è
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏/–≥–∞—Ä–∞–∂–∏
4. **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –ù–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
5. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º
