# ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾: ĞĞ”Ğ˜Ğ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒ = ĞĞ”Ğ˜Ğ Ğ³Ğ°Ñ€Ğ°Ğ¶

## ğŸ“ ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ĞĞ’Ğ¢ĞĞœĞĞ‘Ğ˜Ğ›Ğ¬ (Car)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… garageId: "personal_garage_123"     â”‚  â† Ğ¢ĞĞ›Ğ¬ĞšĞ ĞĞ”Ğ˜Ğ garageId
â”‚  âœ… garageType: PERSONAL                â”‚  â† Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ Ñ‚Ğ¸Ğ¿
â”‚  âŒ ĞĞ• ĞœĞĞ–Ğ•Ğ¢ Ğ±Ñ‹Ñ‚ÑŒ Ğ² Ğ´Ğ²ÑƒÑ… Ğ³Ğ°Ñ€Ğ°Ğ¶Ğ°Ñ…        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ ĞŸÑ€Ğ¸Ğ½Ğ°Ğ´Ğ»ĞµĞ¶Ğ¸Ñ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    PersonalGarage "personal_garage_123" â”‚
â”‚         Ğ˜Ğ›Ğ˜                             â”‚
â”‚    CompanyGarage "COMPANY_garage_456"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ… ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 1: ĞĞ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒ Ğ² Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğ¼ Ğ³Ğ°Ñ€Ğ°Ğ¶Ğµ
```dart
Car(
  id: 'CAR_001',
  ownerId: 'USER_123',
  garageId: 'personal_garage_123',   // ĞĞ”Ğ˜Ğ Ğ³Ğ°Ñ€Ğ°Ğ¶
  garageType: GarageType.personal,
  // ...
)
```

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 2: ĞĞ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒ Ğ² ĞºĞ¾Ñ€Ğ¿Ğ¾Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¼ Ğ³Ğ°Ñ€Ğ°Ğ¶Ğµ
```dart
Car(
  id: 'CAR_002',
  ownerId: 'COMPANY_456',
  garageId: 'COMPANY_garage_456',    // ĞĞ”Ğ˜Ğ Ğ³Ğ°Ñ€Ğ°Ğ¶
  garageType: GarageType.company,
  // ...
)
```

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 3: ĞŸĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ° Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ³Ğ°Ñ€Ğ°Ğ¶Ğ°Ğ¼Ğ¸
```dart
// Ğ”Ğ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸
Car(garageId: 'personal_garage_123', garageType: PERSONAL)

// ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸ (Ğ·Ğ°Ğ¼ĞµĞ½Ğ° ĞĞ”ĞĞĞ“Ğ Ğ³Ğ°Ñ€Ğ°Ğ¶Ğ° Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ĞĞ”Ğ˜Ğ)
await carService.transferCarToGarage(
  carId: 'CAR_001',
  newGarageId: 'COMPANY_garage_456',
  newGarageType: 'COMPANY',
);

// ĞŸĞĞ¡Ğ›Ğ• Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸ (garageId Ğ·Ğ°Ğ¼ĞµĞ½ĞµĞ½)
Car(garageId: 'COMPANY_garage_456', garageType: COMPANY)
```

## âŒ ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸

### âŒ Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 1: Ğ”Ğ²Ğ° Ğ³Ğ°Ñ€Ğ°Ğ¶Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾
```dart
// ĞĞ•Ğ’ĞĞ—ĞœĞĞ–ĞĞ - Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ² Ğ´Ğ²ÑƒÑ… Ğ¼ĞµÑÑ‚Ğ°Ñ…
Car(
  garageId: 'personal_garage_123',  // ĞĞµĞ»ÑŒĞ·Ñ Ğ¸Ğ¼ĞµÑ‚ÑŒ Ğ´Ğ²Ğ° garageId
  // secondGarageId: 'COMPANY_garage_456',  // âŒ Ğ¢Ğ°ĞºĞ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»Ñ ĞĞ•Ğ¢
)
```

### âŒ Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 2: ĞĞµÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ° Ğ¸ Ñ‚Ğ¸Ğ¿Ğ°
```dart
// ĞĞ•Ğ’ĞĞ›Ğ˜Ğ”ĞĞ - Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑ Ğ½Ğµ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ñ‚Ğ¸Ğ¿Ñƒ
Car(
  garageId: 'personal_garage_123',
  garageType: GarageType.company,  // âŒ ĞĞµÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ!
)

// ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ²ĞµÑ€Ğ½ĞµÑ‚ false
car.validateGarageConsistency()  // false
```

### âŒ Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 3: ĞĞµÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ Ğ³Ğ°Ñ€Ğ°Ğ¶
```dart
// ĞĞ•Ğ’ĞĞ›Ğ˜Ğ”ĞĞ - Ğ³Ğ°Ñ€Ğ°Ğ¶ Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ² Ğ±Ğ°Ğ·Ğµ
Car(
  garageId: 'personal_garage_999',  // âŒ ĞĞµÑ‚ Ñ‚Ğ°ĞºĞ¾Ğ³Ğ¾ Ğ³Ğ°Ñ€Ğ°Ğ¶Ğ°
  garageType: GarageType.personal,
)
```

## ğŸ”’ Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ

### 1. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ² Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Car
```dart
// ĞœĞµÑ‚Ğ¾Ğ´ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ° Ñ‚Ğ¸Ğ¿Ñƒ
bool validateGarageConsistency() {
  if (garageType == GarageType.personal) {
    return garageId.startsWith('personal_garage_');
  } else if (garageType == GarageType.company) {
    return garageId.startsWith('COMPANY_garage_');
  }
  return false;
}
```

### 2. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ² CarService
```dart
// ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ³Ğ°Ñ€Ğ°Ğ¶Ğ° Ğ² Ğ‘Ğ”
await carService.validateCarGarageConsistency(carId);
```

### 3. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ² Firestore Rules
```javascript
match /cars/{carId} {
  allow create: if 
    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ° garageId
    (request.resource.data.garage_type == 'PERSONAL' && 
     request.resource.data.garage_id.matches('personal_garage_.*')) ||
    (request.resource.data.garage_type == 'COMPANY' && 
     request.resource.data.garage_id.matches('COMPANY_garage_.*'));
}
```

## ğŸ“Š Ğ¡Ğ²ÑĞ·Ğ¸ Ğ² Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```
GARAGES Collection
â”œâ”€ personal_garage_123
â”‚  â””â”€ owner_id: USER_123
â””â”€ COMPANY_garage_456
   â””â”€ company_id: COMPANY_456

CARS Collection
â”œâ”€ CAR_001
â”‚  â”œâ”€ garageId: "personal_garage_123"  â† Ğ¡Ğ²ÑĞ·ÑŒ Ñ ĞĞ”ĞĞ˜Ğœ Ğ³Ğ°Ñ€Ğ°Ğ¶Ğ¾Ğ¼
â”‚  â””â”€ garageType: "PERSONAL"
â””â”€ CAR_002
   â”œâ”€ garageId: "COMPANY_garage_456"   â† Ğ¡Ğ²ÑĞ·ÑŒ Ñ ĞĞ”ĞĞ˜Ğœ Ğ³Ğ°Ñ€Ğ°Ğ¶Ğ¾Ğ¼
   â””â”€ garageType: "COMPANY"
```

## ğŸ”„ ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ Ğ³Ğ°Ñ€Ğ°Ğ¶Ğ°Ğ¼Ğ¸

### ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ°Ğ²Ñ‚Ğ¾ ĞĞ”ĞĞĞ“Ğ Ğ³Ğ°Ñ€Ğ°Ğ¶Ğ°
```dart
// Ğ’ÑĞµ Ğ°Ğ²Ñ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ½Ğ°Ğ´Ğ»ĞµĞ¶Ğ°Ñ‚ ÑÑ‚Ğ¾Ğ¼Ñƒ ĞĞ”ĞĞĞœĞ£ Ğ³Ğ°Ñ€Ğ°Ğ¶Ñƒ
final cars = await carService.getCarsByGarage('personal_garage_123');
```

### ĞŸĞµÑ€ĞµĞ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾ Ğ² Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ³Ğ°Ñ€Ğ°Ğ¶
```dart
// Ğ—Ğ°Ğ¼ĞµĞ½Ğ° ĞĞ”ĞĞĞ“Ğ garageId Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ĞĞ”Ğ˜Ğ garageId
await carService.transferCarToGarage(
  carId: carId,
  newGarageId: newGarageId,  // ĞĞ¾Ğ²Ñ‹Ğ¹ ĞĞ”Ğ˜Ğ Ğ³Ğ°Ñ€Ğ°Ğ¶
  // ...
);
```

### Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾ Ğ¸Ğ· Ğ³Ğ°Ñ€Ğ°Ğ¶Ğ°
```dart
// ĞŸÑ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ°Ğ²Ñ‚Ğ¾, Ğ¾Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµÑÑ‚Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ½Ğ°Ğ´Ğ»ĞµĞ¶Ğ°Ñ‚ÑŒ Ğ³Ğ°Ñ€Ğ°Ğ¶Ñƒ
await carService.delete(carId);
// Ğ˜Ğ›Ğ˜ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ½Ğ° SOLD
await carService.updateFields(carId, {'status': 'SOLD'});
```

## âœ… Ğ ĞµĞ·ÑĞ¼Ğµ

| ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|---------|----------|
| **1 Ğ°Ğ²Ñ‚Ğ¾ = 1 Ğ³Ğ°Ñ€Ğ°Ğ¶** | ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒ Ğ¸Ğ¼ĞµĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞĞ”Ğ˜Ğ `garageId` |
| **Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ğ°** | `garageId` Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ `garageType` |
| **ĞŸÑ€ĞµÑ„Ğ¸ĞºÑ** | `personal_garage_*` Ğ´Ğ»Ñ PERSONAL, `COMPANY_garage_*` Ğ´Ğ»Ñ COMPANY |
| **Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ** | ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ Ğ¸ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğµ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»Ñ |
| **ĞŸĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ°** | Ğ—Ğ°Ğ¼ĞµĞ½Ğ° ĞĞ”ĞĞĞ“Ğ Ğ³Ğ°Ñ€Ğ°Ğ¶Ğ° Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ĞĞ”Ğ˜Ğ Ğ³Ğ°Ñ€Ğ°Ğ¶ |
| **Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** | Ğ“Ğ°Ñ€Ğ°Ğ¶ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸ `garages` |

## ğŸš€ ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ° Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ°

1. âœ… **ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ğ°** - Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¿Ğ¾Ğ½ÑÑ‚Ğ½Ğ¾, Ğ³Ğ´Ğµ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒ
2. âœ… **Ğ¦ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ** - Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ "Ğ¿Ğ¾Ñ‚ĞµÑ€ÑÑ‚ÑŒ" Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ³Ğ°Ñ€Ğ°Ğ¶Ğ°Ğ¼Ğ¸
3. âœ… **ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ** - Ğ¾Ğ´Ğ¸Ğ½ Ğ¸Ğ½Ğ´ĞµĞºÑ Ğ¿Ğ¾ `garage_id`
4. âœ… **Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ** - Ğ»ĞµĞ³ĞºĞ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
5. âœ… **Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ** - Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸ Ñ‡ĞµÑ€ĞµĞ· `transferred_at`
